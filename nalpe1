using Eplan.EplApi.DataModel;
using Eplan.EplApi.HEServices;
using System.Windows.Forms;

namespace EplanMacroInsert
{
    public class InsertMacro
    {
        public void InsertMacroAtCoordinates()
        {
            try
            {
                // Initialize EPLAN project manager
                ProjectManager projectManager = new ProjectManager();

                // Get the active project
                Project currentProject = projectManager.GetCurrentProject();

                if (currentProject == null)
                {
                    MessageBox.Show("No active project found!");
                    return;
                }

                // Define the coordinates for the macro placement
                double xCoordinate = 100.0;  // X position
                double yCoordinate = 50.0;   // Y position

                // Specify the path to the macro file
                string macroPath = @"C:\EplanMacros\Test1.ema";  // Adjust this path to your macro file location

                if (!System.IO.File.Exists(macroPath))
                {
                    MessageBox.Show($"Macro file not found: {macroPath}");
                    return;
                }

                // Use the Insert service to insert the macro
                Insert insertService = new Insert();

                // Set the insertion point (coordinates)
                PointD insertionPoint = new PointD(xCoordinate, yCoordinate);

                // Insert the symbol macro
                insertService.SymbolMacro(
                    macroPath,          // Path to the macro file
                    currentProject,     // The active project
                    insertionPoint,     // Coordinates for the macro
                    0.0                 // Rotation angle
                );

                MessageBox.Show("Macro inserted successfully at the specified coordinates.");
            }
            catch (System.Exception ex)
            {
                MessageBox.Show($"Error: {ex.Message}");
            }
        }
    }
}
