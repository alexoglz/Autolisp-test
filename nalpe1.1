using Eplan.EplApi.Base;
using Eplan.EplApi.DataModel;
using Eplan.EplApi.HEServices;
using System.Windows.Forms;

public class InsertMacroScript
{
    [Start]
    public void RunInsertMacroScript()
    {
        try
        {
            // Initialize project manager and get the active project
            ProjectManager projectManager = new ProjectManager();
            Project currentProject = projectManager.CurrentProject;

            if (currentProject == null)
            {
                MessageBox.Show("No active project found!");
                return;
            }

            // Define the target page
            string pageName = "PAGE_NAME";  // Replace with your page name
            Page targetPage = currentProject.Pages.FirstOrDefault(p => p.Name == pageName);

            if (targetPage == null)
            {
                MessageBox.Show(string.Format("Page '{0}' not found!", pageName));
                return;
            }

            // Define the macro path and insertion point
            string macroPath = @"C:\Path\To\Your\Macro\Test1.ema";  // Update this path
            PointD insertionPoint = new PointD(100.0, 50.0);         // Adjust coordinates as needed

            // Insert the macro
            Insert insertService = new Insert();
            insertService.WindowMacro(
                macroPath, 0, targetPage, insertionPoint, Insert.MoveKind.Absolute
            );

            // Display success message
            MessageBox.Show("Window macro inserted successfully!");
        }
        catch (System.Exception ex)
        {
            MessageBox.Show(string.Format("Error: {0}", ex.Message));
        }
    }
}
