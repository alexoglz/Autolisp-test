using Eplan.EplApi.Base;
using Eplan.EplApi.DataModel;
using Eplan.EplApi.HEServices;
using System.Windows.Forms;

public class InsertMacroScript
{
    [Start]  // This attribute is necessary for EPLAN scripts
    public void RunInsertMacroScript()
    {
        try
        {
            // Initialize project manager and get the active project
            ProjectManager projectManager = new ProjectManager();
            Project currentProject = projectManager.CurrentProject;

            if (currentProject == null)
            {
                MessageBox.Show("No active project found!");
                return;
            }

            // Define the target page where you want to insert the macro
            string pageName = "PAGE_NAME";  // Change this to the correct page name
            Page targetPage = currentProject.Pages.FirstOrDefault(p => p.Name == pageName);

            if (targetPage == null)
            {
                MessageBox.Show($"Page '{pageName}' not found!");
                return;
            }

            // Define the path to your macro file and insertion point
            string macroPath = @"C:\Path\To\Your\Macro\Test1.ema";  // Update with your macro path
            PointD insertionPoint = new PointD(100.0, 50.0);         // Update coordinates as needed

            // Insert the window macro
            Insert insertService = new Insert();
            insertService.WindowMacro(
                macroPath, 0, targetPage, insertionPoint, Insert.MoveKind.Absolute
            );

            // Display confirmation message
            MessageBox.Show("Window macro inserted successfully!");
        }
        catch (System.Exception ex)
        {
            MessageBox.Show($"Error: {ex.Message}");
        }
    }
}
